# ParaPerf - å¹¶è¡Œç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Shell](https://img.shields.io/badge/Shell-Bash-green.svg)](https://www.gnu.org/software/bash/)
[![Platform](https://img.shields.io/badge/Platform-Ubuntu%2022.04%2B-blue.svg)](https://ubuntu.com/)

åŸºäºiperf3çš„ä¸“ä¸šé›†ç¾¤ç½‘ç»œæ€§èƒ½æµ‹è¯•å·¥å…·ï¼Œä¸“ä¸ºé«˜é€Ÿç½‘ç»œç¯å¢ƒï¼ˆå¦‚25G/100Gç½‘ç»œï¼‰è®¾è®¡ï¼Œæ”¯æŒå¤šç§æµ‹è¯•æ¨¡å¼ã€åŒå‘æµ‹è¯•å’Œç¦»çº¿éƒ¨ç½²ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **è‡ªåŠ¨åŒ–éƒ¨ç½²**: è‡ªåŠ¨å®‰è£…iperf3åŠæ‰€æœ‰ä¾èµ–å·¥å…·
- ğŸ” **SSHç®¡ç†**: æ— éœ€æ‰‹åŠ¨é…ç½®ï¼Œè‡ªåŠ¨å¤„ç†SSHè¿æ¥å’Œè®¤è¯
- ğŸ” **æ™ºèƒ½æ£€æµ‹**: è‡ªåŠ¨å‘ç°ç¦»çº¿ä¸»æœºå¹¶æä¾›è¯¦ç»†æç¤º
- âš¡ **å¹¶å‘æµ‹è¯•**: æ”¯æŒå¯é…ç½®çš„å¹¶è¡Œæµ‹è¯•ï¼Œå¤§å¹…æå‡æµ‹è¯•æ•ˆç‡
- ğŸ”„ **åŒå‘æµ‹è¯•**: æ”¯æŒåŒæ—¶æµ‹è¯•ä¸Šè¡Œå’Œä¸‹è¡Œå¸¦å®½ **[NEW]**
- ğŸ¯ **å¤šç§æ¨¡å¼**: 5ç§æµ‹è¯•é…å¯¹æ¨¡å¼é€‚åº”ä¸åŒæµ‹è¯•åœºæ™¯
- ğŸ“Š **å¤šæ ¼å¼è¾“å‡º**: è¡¨æ ¼ã€JSONã€CSVä¸‰ç§æ ¼å¼ï¼Œæ”¯æŒæ•°æ®åˆ†æ
- ğŸŒ **ç½‘å¡è¯†åˆ«**: è‡ªåŠ¨æ˜¾ç¤ºæµ‹è¯•IPå¯¹åº”çš„ç½‘å¡æ¥å£ä¿¡æ¯
- ğŸ“¦ **ç¦»çº¿æ”¯æŒ**: å®Œæ•´çš„ç¦»çº¿å®‰è£…åŒ…ï¼Œæ”¯æŒæ— ç½‘ç»œç¯å¢ƒéƒ¨ç½²
- ğŸ“ **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„æ“ä½œè®°å½•å’Œé”™è¯¯è¯Šæ–­ä¿¡æ¯
- ğŸ›¡ï¸ **é”™è¯¯æ¢å¤**: å¼ºå¤§çš„é”™è¯¯å¤„ç†å’Œè‡ªåŠ¨é‡è¯•æœºåˆ¶

## ğŸ—ï¸ ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Ubuntu 22.04.5 æˆ–æ›´æ–°ç‰ˆæœ¬
- **æƒé™**: å…·æœ‰sudoæƒé™çš„ç”¨æˆ·è´¦æˆ·
- **ç½‘ç»œ**: æµ‹è¯•ä¸»æœºé—´éœ€è¦ç›¸äº’è®¿é—®ï¼Œç«¯å£5201åŠä»¥ä¸Šå¯ç”¨
- **ä¾èµ–å·¥å…·**: `iperf3`, `jq`, `sshpass`, `bc` (è„šæœ¬å¯è‡ªåŠ¨å®‰è£…)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è·å–é¡¹ç›®

```bash
git clone https://github.com/wuchanghui5220/pot.git
cd pot/paraperf
chmod +x *.sh
```

### 2. å‡†å¤‡ä¸»æœºåˆ—è¡¨

```bash
# å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶å¹¶ç¼–è¾‘
vim hosts.txt

# æ ¼å¼ï¼šæ¯è¡Œä¸€ä¸ªIPåœ°å€æˆ–ä¸»æœºå
# 192.168.200.11
# 192.168.200.12
# 192.168.200.13
# 192.168.200.14
# 192.168.200.15
# 192.168.200.16
```

### 3. åŸºæœ¬æµ‹è¯•

```bash
# åŸºæœ¬ç½‘ç»œæ€§èƒ½æµ‹è¯•
./paraperf.sh -u username -p password -f hosts.txt

# åŒå‘æµ‹è¯•ï¼ˆæ¨èï¼‰
./paraperf.sh -u username -p password -f hosts.txt -b
```

## ğŸ“‹ æµ‹è¯•æ¨¡å¼è¯¦è§£

| æ¨¡å¼ | è¯´æ˜ | æµ‹è¯•è¿æ¥æ•° | é€‚ç”¨åœºæ™¯ |
|------|------|------------|----------|
| **full** | å…¨è¿æ¥æµ‹è¯• | NÃ—(N-1) | å…¨é¢æ€§èƒ½è¯„ä¼°ï¼Œå‘ç°ç“¶é¢ˆ |
| **star** | æ˜Ÿå½¢æµ‹è¯• | N-1 | ä¸­å¿ƒèŠ‚ç‚¹æ€§èƒ½è¯„ä¼° |
| **ring** | ç¯å½¢æµ‹è¯• | N | åŸºç¡€è¿é€šæ€§éªŒè¯ |
| **pair** | å¯¹ç­‰æµ‹è¯• | N/2 | å¿«é€Ÿæ€§èƒ½æŠ½æ · |
| **opposite** | å¯¹ç§°æµ‹è¯• | N/2 | å¯¹ç§°æ€§èƒ½éªŒè¯ |

### æµ‹è¯•æ¨¡å¼å›¾è§£

```
Fullæ¨¡å¼ (N=4):        Staræ¨¡å¼ (N=4):        Ringæ¨¡å¼ (N=4):
A â†â†’ B,C,D            A â†â†’ B,C,D             A â†’ B â†’ C â†’ D â†’ A
B â†â†’ C,D              B,C,D â†’ A              
C â†â†’ D                                       

Pairæ¨¡å¼ (N=4):        Oppositeæ¨¡å¼ (N=4):
A â†â†’ B                A â†â†’ D
C â†â†’ D                B â†â†’ C
```

## ğŸ’¡ åŒå‘æµ‹è¯•åŠŸèƒ½

ParaPerfæ”¯æŒiperf3çš„åŒå‘æµ‹è¯•åŠŸèƒ½ï¼Œå¯ä»¥åŒæ—¶æµ‹è¯•ä¸Šè¡Œå’Œä¸‹è¡Œå¸¦å®½ï¼š

### åŸºæœ¬ç”¨æ³•

```bash
# å¯ç”¨åŒå‘æµ‹è¯•
./paraperf.sh -u admin -p password -f hosts.txt -b

# åŒå‘å…¨è¿æ¥æµ‹è¯•
./paraperf.sh -u admin -p password -f hosts.txt -m full -b

# åŒå‘æµ‹è¯•ç»“æœCSVè¾“å‡º
./paraperf.sh -u admin -p password -f hosts.txt -b -o csv
```

### åŒå‘æµ‹è¯•è¾“å‡ºç¤ºä¾‹

```
ID   æœåŠ¡å™¨  ç½‘å¡ å®¢æˆ·ç«¯  ç½‘å¡ æœåŠ¡å™¨IP     å®¢æˆ·ç«¯IP     ä¸Šè¡Œå¸¦å®½     ä¸‹è¡Œå¸¦å®½     å»¶è¿Ÿ
1    server01 eth0 server02 eth0 192.168.1.10 192.168.1.11 945.67 Mbps  923.45 Mbps  0.234 ms
2    server01 eth0 server03 eth0 192.168.1.10 192.168.1.12 934.21 Mbps  912.78 Mbps  0.287 ms
```

## ğŸ›ï¸ é«˜çº§é…ç½®

### æ€§èƒ½è°ƒä¼˜

```bash
# 25Gç½‘ç»œæ¨èé…ç½®
./paraperf.sh -u admin -p password -f hosts.txt -j 4 -d 30 -b

# 100Gç½‘ç»œé«˜æ€§èƒ½æµ‹è¯•
./paraperf.sh -u admin -p password -f hosts.txt -j 8 -d 60 -c 3

# UDPåè®®æµ‹è¯•
./paraperf.sh -u admin -p password -f hosts.txt -t udp -b
```

### çº¿ç¨‹æ•°é…ç½®æŒ‡å—

| ç½‘ç»œå¸¦å®½ | æ¨èçº¿ç¨‹æ•° | è¯´æ˜ |
|----------|------------|------|
| 1G | 1 | å•çº¿ç¨‹è¶³å¤Ÿ |
| 10G | 2-4 | å……åˆ†åˆ©ç”¨å¸¦å®½ |
| 25G | 4-8 | æ¨èé…ç½® |
| 40G+ | 8-16 | é«˜æ€§èƒ½ç½‘ç»œ |

### å‚æ•°å®Œæ•´åˆ—è¡¨

```bash
./paraperf.sh [é€‰é¡¹]

å¿…éœ€å‚æ•°:
  -u, --username USERNAME     SSHè¿æ¥ç”¨æˆ·å
  -p, --password PASSWORD     SSHè¿æ¥å¯†ç 
  -f, --hostfile FILE         ä¸»æœºåˆ—è¡¨æ–‡ä»¶

å¯é€‰å‚æ•°:
  -m, --mode MODE             é…å¯¹æ¨¡å¼ [full|ring|star|pair|opposite] (é»˜è®¤: full)
  -c, --concurrent NUM        å¹¶å‘æµ‹è¯•æ•°é‡ (é»˜è®¤: 5)
  -d, --duration SECONDS      æ¯æ¬¡æµ‹è¯•æŒç»­æ—¶é—´ (é»˜è®¤: 10)
  -j, --threads NUM           iperf3å¹¶è¡Œçº¿ç¨‹æ•° (é»˜è®¤: 1, èŒƒå›´: 1-128)
  -P, --port PORT             iperf3ç«¯å£ (é»˜è®¤: 5201)
  -t, --protocol PROTO        åè®®ç±»å‹ [tcp|udp] (é»˜è®¤: tcp)
  -o, --output FORMAT         è¾“å‡ºæ ¼å¼ [table|json|csv] (é»˜è®¤: table)
  -b, --bidirectional         å¯ç”¨åŒå‘æµ‹è¯•æ¨¡å¼
  -v, --verbose               è¯¦ç»†è¾“å‡º
  -n, --dry-run               è¯•è¿è¡Œæ¨¡å¼ (ä¸æ‰§è¡Œå®é™…æµ‹è¯•)
  -F, --force-install         å¼ºåˆ¶é‡æ–°å®‰è£…iperf3
  -h, --help                  æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

## ğŸ“¦ ç¦»çº¿éƒ¨ç½²

### å‡†å¤‡ç¦»çº¿å®‰è£…åŒ…

```bash
# åœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šæ‰§è¡Œ
./prepare-iperf3-offline.sh

# æŒ‡å®šæ¶æ„å’Œç‰ˆæœ¬
./prepare-iperf3-offline.sh -a amd64 -v 22.04

# å¼ºåˆ¶é‡æ–°ä¸‹è½½
./prepare-iperf3-offline.sh -f
```

### ç¦»çº¿å®‰è£…

```bash
# 1. å°†paraperf-offlineç›®å½•å¤åˆ¶åˆ°ç›®æ ‡ä¸»æœº
scp -r paraperf-offline/ user@target-host:/tmp/

# 2. åœ¨ç›®æ ‡ä¸»æœºä¸Šå®‰è£…
cd /tmp/paraperf-offline
./install.sh

# 3. éªŒè¯å®‰è£…
iperf3 --version
```

## ğŸ“Š è¾“å‡ºæ ¼å¼

### è¡¨æ ¼æ ¼å¼ï¼ˆé»˜è®¤ï¼‰
```
ID   æœåŠ¡å™¨    ç½‘å¡   å®¢æˆ·ç«¯    ç½‘å¡   æœåŠ¡å™¨IP      å®¢æˆ·ç«¯IP      å¸¦å®½          å»¶è¿Ÿ
1    server01  eth0   server02  eth0   192.168.1.10  192.168.1.11  945.67 Mbps   0.234 ms
```

### JSONæ ¼å¼
```json
{
  "test_info": {
    "timestamp": "2024-01-15T10:30:00Z",
    "pairing_mode": "full",
    "protocol": "tcp",
    "duration": 10,
    "bidirectional": true
  },
  "results": [
    {
      "test_id": 1,
      "server": "192.168.1.10",
      "client": "192.168.1.11",
      "bandwidth_forward": 945.67,
      "bandwidth_reverse": 923.45,
      "unit": "Mbps",
      "rtt": 0.234,
      "status": "SUCCESS"
    }
  ]
}
```

### CSVæ ¼å¼
```csv
test_id,server_ip,client_ip,bandwidth_forward,bandwidth_reverse,rtt,status
1,192.168.1.10,192.168.1.11,945.67,923.45,0.234,SUCCESS
```

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. SSHè¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥SSHè¿é€šæ€§
ssh -o ConnectTimeout=10 user@host

# å¸¸è§è§£å†³æ–¹æ¡ˆï¼š
- éªŒè¯ç”¨æˆ·åå’Œå¯†ç 
- æ£€æŸ¥ç›®æ ‡ä¸»æœºSSHæœåŠ¡çŠ¶æ€
- ç¡®è®¤ç½‘ç»œè¿é€šæ€§
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
```

#### 2. iperf3å®‰è£…å¤±è´¥
```bash
# æ‰‹åŠ¨å®‰è£…iperf3
sudo apt-get update
sudo apt-get install -y iperf3 jq sshpass bc

# æˆ–ä½¿ç”¨ç¦»çº¿åŒ…
cd paraperf-offline
./install.sh
```

#### 3. æƒé™ä¸è¶³
```bash
# æ£€æŸ¥sudoæƒé™
sudo -l

# ç¡®ä¿ç”¨æˆ·åœ¨sudoersæ–‡ä»¶ä¸­
sudo usermod -aG sudo username
```

#### 4. ç«¯å£å ç”¨
```bash
# æ£€æŸ¥ç«¯å£ä½¿ç”¨æƒ…å†µ
netstat -tlnp | grep 5201

# åœæ­¢å ç”¨è¿›ç¨‹
sudo pkill -f iperf3

# æˆ–ä½¿ç”¨å…¶ä»–ç«¯å£
./paraperf.sh -u user -p pass -f hosts.txt -P 5202
```

#### 5. æµ‹è¯•ç»“æœå¼‚å¸¸

**å¸¦å®½è¿‡ä½**ï¼š
- æ£€æŸ¥ç½‘ç»œé…ç½®å’Œç½‘å¡é©±åŠ¨
- å¢åŠ å¹¶è¡Œçº¿ç¨‹æ•° (`-j 4`)
- æ£€æŸ¥ç½‘ç»œæ‹¥å¡æƒ…å†µ

**å»¶è¿Ÿè¿‡é«˜**ï¼š
- æ£€æŸ¥ç½‘ç»œè·¯ç”±
- éªŒè¯äº¤æ¢æœºé…ç½®
- æ’æŸ¥ç½‘ç»œè®¾å¤‡è´Ÿè½½

**æµ‹è¯•å¤±è´¥**ï¼š
- ä½¿ç”¨ `-v` å‚æ•°æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
- æ£€æŸ¥ `.paraperf/logs/paraperf.log`
- éªŒè¯ä¸»æœºé—´è¿é€šæ€§

### æ—¥å¿—æŸ¥çœ‹

```bash
# æŸ¥çœ‹ä¸»æ—¥å¿—
cat .paraperf/logs/paraperf.log

# æŸ¥çœ‹è¯¦ç»†è¾“å‡º
./paraperf.sh -u user -p pass -f hosts.txt -v

# è¯•è¿è¡Œæ¨¡å¼è°ƒè¯•
./paraperf.sh -u user -p pass -f hosts.txt -n
```

## ğŸ“ˆ æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç­–ç•¥
- **åˆæ¬¡æµ‹è¯•**: ä½¿ç”¨ringæ¨¡å¼å¿«é€ŸéªŒè¯è¿é€šæ€§
- **æ€§èƒ½åŸºçº¿**: ä½¿ç”¨pairæ¨¡å¼å»ºç«‹æ€§èƒ½åŸºçº¿
- **å…¨é¢è¯„ä¼°**: ä½¿ç”¨fullæ¨¡å¼è¿›è¡Œå®Œæ•´æ€§èƒ½æµ‹è¯•
- **ç“¶é¢ˆåˆ†æ**: ä½¿ç”¨staræ¨¡å¼æ£€æµ‹ä¸­å¿ƒèŠ‚ç‚¹æ€§èƒ½

### 2. å‚æ•°è°ƒä¼˜
- **é«˜é€Ÿç½‘ç»œ**: ä½¿ç”¨å¤šçº¿ç¨‹ (`-j 4-8`) å……åˆ†åˆ©ç”¨å¸¦å®½
- **ç”Ÿäº§ç¯å¢ƒ**: é€‚å½“å»¶é•¿æµ‹è¯•æ—¶é—´ (`-d 30-60`) è·å¾—ç¨³å®šç»“æœ
- **å¤§è§„æ¨¡é›†ç¾¤**: é™åˆ¶å¹¶å‘æ•° (`-c 2-3`) é¿å…è¿‡è½½

### 3. æ•°æ®åˆ†æ
- ä½¿ç”¨CSVæ ¼å¼å¯¼å‡ºæ•°æ®è¿›è¡Œæ·±åº¦åˆ†æ
- å…³æ³¨åŒå‘æµ‹è¯•çš„å¸¦å®½ä¸å¯¹ç§°æ€§
- ç›‘æ§å»¶è¿ŸæŠ–åŠ¨å’Œé‡ä¼ ç‡

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿å„ç§å½¢å¼çš„è´¡çŒ®ï¼

### æŠ¥å‘Šé—®é¢˜
- ä½¿ç”¨GitHub IssuesæŠ¥å‘Šbugs
- æä¾›è¯¦ç»†çš„ç¯å¢ƒä¿¡æ¯å’Œæ—¥å¿—
- åŒ…å«é‡ç°æ­¥éª¤

### åŠŸèƒ½è¯·æ±‚
- æäº¤åŠŸèƒ½è¯·æ±‚å‰è¯·å…ˆæœç´¢å·²æœ‰issues
- è¯¦ç»†æè¿°éœ€æ±‚å’Œä½¿ç”¨åœºæ™¯
- æ¬¢è¿æä¾›è®¾è®¡æ€è·¯

### ä»£ç è´¡çŒ®
1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æ‰“å¼€Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯å¼€æº - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ† è‡´è°¢

- æ„Ÿè°¢ [iperf3](https://github.com/esnet/iperf) é¡¹ç›®æä¾›å¼ºå¤§çš„ç½‘ç»œæµ‹è¯•æ ¸å¿ƒ
- æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œç”¨æˆ·çš„åé¦ˆ

## ğŸ“ æ”¯æŒ

- ğŸ“§ é—®é¢˜åé¦ˆ: [GitHub Issues](https://github.com/your-repo/paraperf/issues)
- ğŸ’¬ è®¨è®ºäº¤æµ: [GitHub Discussions](https://github.com/your-repo/paraperf/discussions)
- ğŸ“– æ–‡æ¡£æ›´æ–°: æ¬¢è¿æäº¤æ–‡æ¡£æ”¹è¿›

---

**ParaPerf** - è®©ç½‘ç»œæ€§èƒ½æµ‹è¯•æ›´ç®€å•ã€æ›´å¼ºå¤§ï¼ ğŸš€
